{% extends 'base.html' %}
{% load static %}

{% block title %}Configuracoes - {{ agency_name }}{% endblock %}

{% block sidebar %}
{% include 'components/sidebar.html' %}
{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1 class="page-title">Configuracoes</h1>
    </div>

    <div class="grid-responsive-2">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">OpenRouter API Key</h3>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="update_api_key">
                    <div class="form-group">
                        <label class="form-label">API Key</label>
                        <input type="password" name="openrouter_api_key" class="form-input"
                            placeholder="{% if has_api_key %}************{% else %}sk-or-v1-...{% endif %}">
                        <span class="form-help">{% if has_api_key %}API key configurada.{% else %}Obtenha em
                            openrouter.ai{% endif %}</span>
                    </div>
                    <div class="flex gap-3">
                        <button type="submit" class="btn btn-primary">Salvar</button>
                        <button type="submit" name="action" value="test_api_key"
                            class="btn btn-secondary">Testar</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Conex칚o WhatsApp</h3>
            </div>
            <div class="card-body">
                <p style="font-size: 13px; color: #6b7280; margin-bottom: 16px;">
                    Conecte seu WhatsApp para enviar acessos e notifica칞칫es automaticamente aos clientes.
                </p>
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        {% if is_connected %}
                        <div class="status-badge status-success"
                            style="display: flex; align-items: center; gap: 8px; padding: 6px 12px; background: rgba(16, 185, 129, 0.1); color: #10b981; border-radius: 20px; font-weight: 500; font-size: 14px;">
                            <span style="width: 8px; height: 8px; background: #10b981; border-radius: 50%;"></span>
                            Conectado
                        </div>
                        {% elif is_configured %}
                        <div class="status-badge status-warning"
                            style="display: flex; align-items: center; gap: 8px; padding: 6px 12px; background: rgba(245, 158, 11, 0.1); color: #f59e0b; border-radius: 20px; font-weight: 500; font-size: 14px;">
                            <span style="width: 8px; height: 8px; background: #f59e0b; border-radius: 50%;"></span>
                            Desconectado
                        </div>
                        {% else %}
                        <div class="status-badge status-secondary"
                            style="display: flex; align-items: center; gap: 8px; padding: 6px 12px; background: rgba(107, 114, 128, 0.1); color: #6b7280; border-radius: 20px; font-weight: 500; font-size: 14px;">
                            <span style="width: 8px; height: 8px; background: #6b7280; border-radius: 50%;"></span>
                            N칚o Configurado
                        </div>
                        {% endif %}
                    </div>
                    <a href="{% url 'whatsapp:config' %}" class="btn btn-secondary">
                        Gerenciar Conex칚o
                    </a>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Personalizacao da Marca</h3>
            </div>
            <div class="card-body">
                <p style="font-size: 13px; color: #6b7280; margin-bottom: 16px;">Defina o logo, nome e cores da sua
                    agencia.</p>
                <div class="flex items-center gap-3">
                    <div class="p-3 bg-gray-50 rounded-lg border border-gray-100">
                        {% if agency.logo_light %}
                        <img src="{{ agency.logo_light.url }}" alt="Logo" style="height: 32px; object-fit: contain;">
                        {% else %}
                        <div
                            style="height: 32px; width: 32px; background: var(--primary-color); border-radius: 4px; display: flex; align-items: center; justify-content: center; color: white;">
                            P</div>
                        {% endif %}
                    </div>
                    <a href="{% url 'dashboard:branding_settings' %}" class="btn btn-secondary" style="width: 100%;">
                        Gerenciar Identidade Visual
                    </a>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Modelos Padrao da Agencia</h3>
            </div>
            <div class="card-body">
                <p style="font-size: 13px; color: #6b7280; margin-bottom: 16px;">Usados quando o projeto nao
                    especifica
                    modelo proprio.</p>
                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="update_models">
                                        <div class="form-group">
                        <label class="form-label">Modelo de Texto</label>
                        <select name="default_text_model" class="form-select"
                            title="Escolha o modelo padr칚o para gera칞칚o de texto. Modelos econ칪micos s칚o recomendados para blogs de alto volume.">
                            <optgroup label="游눜 ECON칎MICOS - Melhor Custo-Benef칤cio">
                                <option value="google/gemma-3-27b:free" {% if agency.default_text_model == 'google/gemma-3-27b:free' %}selected{% endif %}>游눜 Gemma 3 27B - GR츼TIS</option>
                                <option value="qwen/qwen2.5-7b-instruct" {% if agency.default_text_model == 'qwen/qwen2.5-7b-instruct' %}selected{% endif %}>游눜 Qwen2.5 7B - $0.04/$0.10</option>
                                <option value="qwen/qwen3-32b" {% if agency.default_text_model == 'qwen/qwen3-32b' %}selected{% endif %}>游눜 Qwen3 32B - $0.08/$0.24</option>
                                <option value="mistralai/mistral-small-3" {% if agency.default_text_model == 'mistralai/mistral-small-3' %}selected{% endif %}>游눜 Mistral Small 3 - $0.03/$0.11</option>
                                <option value="mistralai/ministral-3-14b-2512" {% if agency.default_text_model == 'mistralai/ministral-3-14b-2512' %}selected{% endif %}>游눜 Ministral 3 14B - $0.20/M</option>
                                <option value="deepseek/deepseek-v3" {% if agency.default_text_model == 'deepseek/deepseek-v3' %}selected{% endif %}>游눜 DeepSeek V3 - $0.30/$1.20</option>
                                <option value="meta-llama/llama-4-scout" {% if agency.default_text_model == 'meta-llama/llama-4-scout' %}selected{% endif %}>游눜 Llama 4 Scout 17B - $0.08/$0.30</option>
                            </optgroup>
                            <optgroup label="游리 INTERMEDI츼RIOS">
                                <option value="qwen/qwen3-vl-8b-instruct" {% if agency.default_text_model == 'qwen/qwen3-vl-8b-instruct' %}selected{% endif %}>游리 Qwen3 VL 8B - $0.08/$0.50</option>
                                <option value="qwen/qwen3-vl-30b-a3b-instruct" {% if agency.default_text_model == 'qwen/qwen3-vl-30b-a3b-instruct' %}selected{% endif %}>游리 Qwen3 VL 30B - $0.15/$0.60</option>
                                <option value="anthropic/claude-3-haiku" {% if agency.default_text_model == 'anthropic/claude-3-haiku' %}selected{% endif %}>游리 Claude 3 Haiku - $0.25/$1.25</option>
                                <option value="mistralai/mixtral-8x7b-instruct" {% if agency.default_text_model == 'mistralai/mixtral-8x7b-instruct' %}selected{% endif %}>游리 Mixtral 8x7B - $0.54/M</option>
                                <option value="qwen/qwen3-coder-480b-a35b" {% if agency.default_text_model == 'qwen/qwen3-coder-480b-a35b' %}selected{% endif %}>游리 Qwen3 Coder 480B - $0.22/$0.95</option>
                                <option value="openai/gpt-4o" {% if agency.default_text_model == 'openai/gpt-4o' %}selected{% endif %}>游리 GPT-4o - $2.50/$10</option>
                            </optgroup>
                            <optgroup label="游눑 PREMIUM - M치xima Qualidade">
                                <option value="openai/gpt-oss-120b" {% if agency.default_text_model == 'openai/gpt-oss-120b' %}selected{% endif %}>游눑 GPT-OSS 120B - $0.039/$0.19</option>
                                <option value="mistralai/mistral-large-3-2512" {% if agency.default_text_model == 'mistralai/mistral-large-3-2512' %}selected{% endif %}>游눑 Mistral Large 3 - $0.50/$1.50</option>
                                <option value="openai/gpt-5-chat" {% if agency.default_text_model == 'openai/gpt-5-chat' %}selected{% endif %}>游눑 GPT-5 Chat - $1.25/$10</option>
                                <option value="anthropic/claude-3.7-sonnet-thinking" {% if agency.default_text_model == 'anthropic/claude-3.7-sonnet-thinking' %}selected{% endif %}>游눑 Claude 3.7 Sonnet - $3/$15</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Modelo de Imagem</label>
                        <select name="default_image_model" class="form-select"
                            title="Escolha o modelo padr칚o para imagens. Pollinations 칠 gratuito e de alta qualidade.">
                            <optgroup label="游눜 GRATUITO/ECON칎MICO - Pollinations">
                                <option value="pollinations/flux" {% if agency.default_image_model == 'pollinations/flux' %}selected{% endif %}>游눜 Pollinations Flux - Alta qualidade</option>
                                <option value="pollinations/turbo" {% if agency.default_image_model == 'pollinations/turbo' %}selected{% endif %}>游눜 Pollinations Turbo - R치pido</option>
                                <option value="pollinations/flux-realism" {% if agency.default_image_model == 'pollinations/flux-realism' %}selected{% endif %}>游눜 Flux Realism - Fotorealista</option>
                                <option value="pollinations/gptimage" {% if agency.default_image_model == 'pollinations/gptimage' %}selected{% endif %}>游눜 GPTImage</option>
                                <option value="pollinations/gptimage-large" {% if agency.default_image_model == 'pollinations/gptimage-large' %}selected{% endif %}>游눜 GPTImage Large</option>
                            </optgroup>
                            <optgroup label="游리 INTERMEDI츼RIOS - Multimodais">
                                <option value="meta-llama/llama-3.2-11b-vision-instruct" {% if agency.default_image_model == 'meta-llama/llama-3.2-11b-vision-instruct' %}selected{% endif %}>游리 Llama 3.2 11B Vision - $0.049</option>
                                <option value="z-ai/glm-4.6v" {% if agency.default_image_model == 'z-ai/glm-4.6v' %}selected{% endif %}>游리 GLM 4.6V - $0.30/$0.90</option>
                            </optgroup>
                            <optgroup label="游눑 PREMIUM - Gera칞칚o Dedicada">
                                <option value="google/gemini-2.5-flash-image" {% if agency.default_image_model == 'google/gemini-2.5-flash-image' %}selected{% endif %}>游눑 Gemini 2.5 Flash Image - $30/M</option>
                            </optgroup>
                        </select>
                        <span class="form-help" style="font-size: 12px; color: #6b7280;">游눜 = Econ칪mico | 游리 = Intermedi치rio | 游눑 = Premium</span>
                    </div>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                </form>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Seu Plano</h3>
            </div>
            <div class="card-body">
                <div class="flex items-center justify-between mb-4">
                    <span class="text-lg font-semibold">{{ agency.get_plan_display }}</span>
                    {% if agency.subscription_status == 'active' %}
                    <span class="badge badge-success">{{ agency.get_subscription_status_display }}</span>
                    {% else %}
                    <span class="badge badge-warning">{{ agency.get_subscription_status_display }}</span>
                    {% endif %}
                </div>
                <div class="mb-4">
                    <div class="flex justify-between text-sm mb-2">
                        <span>Posts este mes</span>
                        <span>{{ agency.current_month_posts }} / {{ agency.monthly_posts_limit }}</span>
                    </div>
                    <div class="progress">
                        <div class="progress-bar"
                            style="width: {% widthratio agency.current_month_posts agency.monthly_posts_limit 100 %}%">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Equipe</h3>
            </div>
            <div class="card-body">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Membro</th>
                            <th>Role</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for member in team_members %}
                        <tr>
                            <td><strong>{{ member.first_name }} {{ member.last_name }}</strong></td>
                            <td><span class="badge badge-gray">{{ member.get_role_display }}</span></td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="2" class="text-center text-muted">Nenhum membro</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}