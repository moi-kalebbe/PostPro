{% extends 'base.html' %}
{% load static %}

{% block title %}Planos de Cliente - {{ request.user.agency.name }}{% endblock %}

{% block sidebar %}
{% include 'components/sidebar.html' %}
{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1 class="page-title">Planos de Cliente</h1>
        <a href="{% url 'dashboard:plan_create' %}" class="btn btn-primary">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Novo Plano
        </a>
    </div>

    <p class="text-muted mb-6">
        Crie planos personalizados para seus clientes com limite de posts por mês.
    </p>

    {% if plans %}
    <div class="grid grid-cols-3 gap-4">
        {% for plan in plans %}
        <div class="card {% if plan.is_highlighted %}border-primary{% endif %}">
            {% if plan.is_highlighted %}
            <div class="card-header bg-primary text-white">
                <span class="badge badge-warning">★ Recomendado</span>
            </div>
            {% endif %}
            <div class="card-body">
                <h3 class="text-lg font-bold mb-2">{{ plan.name }}</h3>

                {% if plan.price %}
                <div class="text-2xl font-bold text-primary mb-2">
                    R$ {{ plan.price|floatformat:2 }}
                    <span class="text-sm text-muted font-normal">/mês</span>
                </div>
                {% endif %}

                <div class="flex items-center gap-2 mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" class="text-primary">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10 9 9 9 8 9"></polyline>
                    </svg>
                    <span class="font-medium">{{ plan.posts_per_month }} posts/mês</span>
                </div>

                {% if plan.description %}
                <p class="text-muted text-sm mb-4">{{ plan.description|truncatewords:20 }}</p>
                {% endif %}

                {% if plan.features %}
                <ul class="plan-features mb-4">
                    {% for feature in plan.get_features_list %}
                    <li class="flex items-center gap-2 text-sm py-1">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" class="text-success">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        {{ feature }}
                    </li>
                    {% endfor %}
                </ul>
                {% endif %}

                <div class="flex items-center gap-2 text-xs text-muted mb-4">
                    <span>{{ plan.projects.count }} projeto(s) usando</span>
                </div>

                <div class="flex gap-2">
                    <a href="{% url 'dashboard:plan_edit' plan.id %}" class="btn btn-ghost btn-sm flex-1">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                        Editar
                    </a>
                    {% if plan.projects.count == 0 %}
                    <form method="post" action="{% url 'dashboard:plan_delete' plan.id %}"
                        onsubmit="return confirm('Tem certeza que deseja excluir o plano {{ plan.name }}?');">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-ghost btn-sm text-error">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3 6 5 6 21 6"></polyline>
                                <path
                                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                </path>
                            </svg>
                        </button>
                    </form>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="card">
        <div class="card-body text-center p-12">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="1" class="mx-auto text-muted mb-4">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="3" y1="9" x2="21" y2="9"></line>
                <line x1="9" y1="21" x2="9" y2="9"></line>
            </svg>
            <h3 class="text-lg font-medium mb-2">Nenhum plano criado</h3>
            <p class="text-muted mb-4">
                Crie planos personalizados para definir limites de posts por cliente.
            </p>
            <a href="{% url 'dashboard:plan_create' %}" class="btn btn-primary">
                Criar Primeiro Plano
            </a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}