{% extends 'base.html' %}
{% load static %}

{% block title %}{{ project.name }} - PostPro{% endblock %}

{% block sidebar %}
{% include 'components/sidebar.html' %}
{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <div>
            <h1 class="page-title">{{ project.name }}</h1>
            <a href="{{ project.wordpress_url }}" target="_blank" class="text-muted flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                    <polyline points="15 3 21 3 21 9"></polyline>
                    <line x1="10" y1="14" x2="21" y2="3"></line>
                </svg>
                {{ project.wordpress_url|truncatechars:40 }}
            </a>
        </div>
        <div class="flex gap-2">
            <a href="{% url 'projects:batch_upload' project.id %}" class="btn btn-primary">
                Upload CSV
            </a>
            <a href="{% url 'projects:edit' project.id %}" class="btn btn-secondary">
                Editar
            </a>
        </div>
    </div>

    <!-- Stats -->
    <div class="stats-grid mb-6">
        <div class="card">
            <div class="card-body stat-card">
                <span class="stat-label">Total de Posts</span>
                <span class="stat-value">{{ stats.total_posts }}</span>
            </div>
        </div>
        <div class="card">
            <div class="card-body stat-card">
                <span class="stat-label">Publicados</span>
                <span class="stat-value text-success">{{ stats.published }}</span>
            </div>
        </div>
        <div class="card">
            <div class="card-body stat-card">
                <span class="stat-label">Pendentes</span>
                <span class="stat-value text-warning">{{ stats.pending }}</span>
            </div>
        </div>
        <div class="card">
            <div class="card-body stat-card">
                <span class="stat-label">Custo Total</span>
                <span class="stat-value text-primary">${{ stats.total_cost|floatformat:4 }}</span>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-2">
        <!-- Project Settings -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Configurações</h3>
            </div>
            <div class="card-body">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <span class="text-sm text-muted">Tom</span>
                        <div class="font-medium">{{ project.get_tone_display }}</div>
                    </div>
                    <div>
                        <span class="text-sm text-muted">Estilo de Imagem</span>
                        <div class="font-medium">{{ project.get_image_style_display }}</div>
                    </div>
                    <div>
                        <span class="text-sm text-muted">Modelo de Texto</span>
                        <div class="font-medium">{{ project.text_model|default:"Padrão" }}</div>
                    </div>
                    <div>
                        <span class="text-sm text-muted">Modelo de Imagem</span>
                        <div class="font-medium">{{ project.image_model|default:"Padrão" }}</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- License Key -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">License Key</h3>
            </div>
            <div class="card-body">
                <div class="flex items-center gap-3">
                    <code class="code-preview flex-1" style="font-size: 0.75rem; word-break: break-all;">
                        {{ project.license_key }}
                    </code>
                    <button class="btn btn-secondary btn-sm"
                        onclick="copyToClipboard('{{ project.license_key }}', this)">
                        Copiar
                    </button>
                </div>
                <p class="form-help mt-2">
                    Use esta chave para configurar o plugin WordPress no seu site.
                </p>
            </div>
        </div>
    </div>

    <!-- Recent Posts -->
    <div class="card mt-6">
        <div class="card-header">
            <h3 class="card-title">Posts Recentes</h3>
            <a href="{% url 'automation:posts_list' %}?project={{ project.id }}" class="btn btn-ghost btn-sm">Ver
                todos</a>
        </div>
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>Keyword</th>
                        <th>Título</th>
                        <th>Status</th>
                        <th>Custo</th>
                        <th>Data</th>
                    </tr>
                </thead>
                <tbody>
                    {% for post in recent_posts %}
                    <tr>
                        <td><strong>{{ post.keyword|truncatewords:4 }}</strong></td>
                        <td>{{ post.title|truncatewords:6|default:'-' }}</td>
                        <td>
                            <span
                                class="badge badge-{% if post.status == 'published' %}success{% elif post.status == 'pending_review' %}warning{% elif post.status == 'failed' %}error{% else %}info{% endif %}">
                                {{ post.get_status_display }}
                            </span>
                        </td>
                        <td>${{ post.total_cost|floatformat:4 }}</td>
                        <td class="text-muted">{{ post.created_at|date:"d/m H:i" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center text-muted p-6">
                            Nenhum post gerado ainda
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Recent Batches -->
    <div class="card mt-6">
        <div class="card-header">
            <h3 class="card-title">Últimos Jobs</h3>
        </div>
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>Arquivo</th>
                        <th>Status</th>
                        <th>Progresso</th>
                        <th>Tipo</th>
                        <th>Data</th>
                    </tr>
                </thead>
                <tbody>
                    {% for batch in recent_batches %}
                    <tr>
                        <td>{{ batch.original_filename }}</td>
                        <td>
                            <span
                                class="badge badge-{% if batch.status == 'completed' %}success{% elif batch.status == 'processing' %}info{% elif batch.status == 'failed' %}error{% else %}gray{% endif %}">
                                {{ batch.get_status_display }}
                            </span>
                        </td>
                        <td>{{ batch.processed_rows }} / {{ batch.total_rows }}</td>
                        <td>
                            {% if batch.is_dry_run %}
                            <span class="text-warning">Simulação</span>
                            {% else %}
                            Real
                            {% endif %}
                        </td>
                        <td class="text-muted">{{ batch.created_at|date:"d/m H:i" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center text-muted p-6">
                            Nenhum job ainda
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}