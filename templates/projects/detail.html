{% extends 'base.html' %}
{% load static %}

{% block title %}{{ project.name }} - PostPro{% endblock %}

{% block sidebar %}
{% include 'components/sidebar.html' %}
{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <div>
            <h1 class="page-title">{{ project.name }}</h1>
            <a href="{{ project.wordpress_url }}" target="_blank" class="text-muted flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                    <polyline points="15 3 21 3 21 9"></polyline>
                    <line x1="10" y1="14" x2="21" y2="3"></line>
                </svg>
                {{ project.wordpress_url|truncatechars:40 }}
            </a>
        </div>
        <div class="flex gap-2">
            <a href="{% url 'projects:edit' project.id %}" class="btn btn-secondary">Editar Projeto</a>
        </div>
    </div>

    <!-- Stats -->
    <div class="stats-grid mb-6">
        <div class="card">
            <div class="card-body stat-card">
                <span class="stat-label">Total de Posts</span>
                <span class="stat-value">{{ stats.total_posts }}</span>
            </div>
        </div>
        <div class="card">
            <div class="card-body stat-card">
                <span class="stat-label">Publicados</span>
                <span class="stat-value text-success">{{ stats.published }}</span>
            </div>
        </div>
        <div class="card">
            <div class="card-body stat-card">
                <span class="stat-label">Agendados</span>
                <span class="stat-value text-warning">{{ stats.pending }}</span>
            </div>
        </div>
        <div class="card">
            <div class="card-body stat-card">
                <span class="stat-label">Custo Total</span>
                <span class="stat-value text-primary">${{ stats.total_cost|floatformat:4 }}</span>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-2">
        <!-- Palavras do Nicho -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">üéØ Palavras do Nicho</h3>
            </div>
            <div class="card-body">
                <p class="form-help mb-4">Defina as palavras-chave do seu nicho. O PostPro usar√° estas palavras para
                    gerar conte√∫do relevante.</p>
                {% if project.editorial_keywords %}
                <div class="flex flex-wrap gap-2 mb-4">
                    {% for kw in project.editorial_keywords %}
                    <span class="badge badge-primary">{{ kw }}</span>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted mb-4">Nenhuma palavra-chave configurada ainda.</p>
                {% endif %}
                <a href="{% url 'projects:edit' project.id %}" class="btn btn-secondary btn-sm">Configurar Palavras</a>
            </div>
        </div>

        <!-- License Key -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">üîë License Key</h3>
            </div>
            <div class="card-body">
                <p class="form-help mb-3">Use esta chave no plugin WordPress.</p>
                <div class="flex items-center gap-3">
                    <code class="code-preview flex-1"
                        style="font-size: 0.75rem; word-break: break-all;">{{ project.license_key }}</code>
                    <button class="btn btn-secondary btn-sm"
                        onclick="copyToClipboard('{{ project.license_key }}', this)">Copiar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Plano Editorial -->
    <div class="card mt-6">
        <div class="card-header">
            <h3 class="card-title">üìÖ Plano Editorial (30 dias)</h3>
            {% if editorial_plan %}
            <span
                class="badge badge-{% if editorial_plan.status == 'active' %}success{% elif editorial_plan.status == 'pending_approval' %}warning{% else %}info{% endif %}">{{
                editorial_plan.get_status_display }}</span>
            {% endif %}
        </div>
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>Dia</th>
                        <th>T√≠tulo</th>
                        <th>Keyword</th>
                        <th>Status</th>
                        <th>Data</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in editorial_items %}
                    <tr>
                        <td><strong>{{ item.day_index }}</strong></td>
                        <td>{{ item.title|truncatewords:8 }}</td>
                        <td><span class="badge badge-gray">{{ item.keyword_focus }}</span></td>
                        <td>
                            {% if item.status == 'completed' %}
                            <span class="badge badge-success">{{ item.get_status_display }}</span>
                            {% elif item.status == 'generating' %}
                            <span class="badge badge-info">{{ item.get_status_display }}</span>
                            {% elif item.status == 'failed' %}
                            <span class="badge badge-error">{{ item.get_status_display }}</span>
                            {% else %}
                            <span class="badge badge-warning">{{ item.get_status_display }}</span>
                            {% endif %}
                        </td>
                        <td class="text-muted">{{ item.scheduled_date|date:"d/m/Y" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center text-muted p-6">
                            Nenhum plano editorial ativo. Configure as palavras do nicho para gerar um plano.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Posts Recentes -->
    <div class="card mt-6">
        <div class="card-header">
            <h3 class="card-title">üìù Posts Recentes</h3>
            <a href="{% url 'automation:posts_list' %}?project={{ project.id }}" class="btn btn-ghost btn-sm">Ver
                todos</a>
        </div>
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>T√≠tulo</th>
                        <th>Status</th>
                        <th>Custo</th>
                        <th>Data</th>
                    </tr>
                </thead>
                <tbody>
                    {% for post in recent_posts %}
                    <tr>
                        <td><strong>{{ post.title|truncatewords:6|default:post.keyword }}</strong></td>
                        <td>
                            {% if post.status == 'published' %}
                            <span class="badge badge-success">{{ post.get_status_display }}</span>
                            {% elif post.status == 'pending_review' %}
                            <span class="badge badge-warning">{{ post.get_status_display }}</span>
                            {% elif post.status == 'failed' %}
                            <span class="badge badge-error">{{ post.get_status_display }}</span>
                            {% else %}
                            <span class="badge badge-info">{{ post.get_status_display }}</span>
                            {% endif %}
                        </td>
                        <td>${{ post.total_cost|floatformat:4 }}</td>
                        <td class="text-muted">{{ post.created_at|date:"d/m H:i" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="text-center text-muted p-6">Nenhum post gerado ainda</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}